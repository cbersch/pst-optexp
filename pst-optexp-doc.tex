\documentclass[headinclude,DIV12]{scrartcl}

\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{textcomp}

\usepackage{scrpage2}
\usepackage{url}
%
\usepackage{pstricks}
\usepackage{pst-optexp}
\let\verPstOptExp\fileversion
\let\datePstOptExp\filedate
\usepackage{multicol}
\usepackage{showexpl}
\lstset{breakatwhitespace}
\usepackage{nicefrac}
\usepackage{graphicx}
\usepackage{array}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{caption}[2008/04/01]
\usepackage[colorlinks,linktocpage]{hyperref}
%
% New commands
%
\DeclareRobustCommand\cs[1]{\texttt{\char`\\#1}}
\newcommand{\OptExpPackage}{\textsf{`pst-optexp'}}
\newcommand{\parameter}[1]{\texttt{#1}}
\let\param\textrm
\newcommand{\paramvalue}[1]{\texttt{#1}}
\newcommand{\defaultparam}[1]{\emph{default:} \paramvalue{#1}}
\newcommand{\paramitem}[3]{\item[\param{#1}:] \paramvalue{#2} (\defaultparam{#3})}
\newcolumntype{T}{>{\ttfamily}l}
\newcolumntype{B}{>{\bfseries}l}
%
% Settings
\setkomafont{sectioning}{\normalfont\normalcolor\bfseries}
%
\makeatletter
\renewenvironment{description}
  {\list{}{\labelwidth\z@ \itemindent-0.5\leftmargin
    \itemsep0pt \parsep0pt
    \let\makelabel\descriptionlabel}}
  {\endlist}
\makeatother
%
\clearscrheadfoot
\setheadsepline{0.4pt}
\ihead{\OptExpPackage}\ohead{A PSTricks package to draw optical experimental setups}
\ofoot{\pagemark}
\pagestyle{scrheadings}

\psset{subgriddiv=0,griddots=10,gridlabels=7pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
 \title{\texttt{pst-optexp}\\ A PSTricks package to draw optical experimental setups}
 \author{Christoph Bersch \textless
   \href{mailto:usenet@bersch.net}{\texttt{usenet@bersch.net}}\textgreater}
 \date{\datePstOptExp\enspace\enspace Version \verPstOptExp}

\maketitle

\setlength{\columnseprule}{0.6pt}
\begin{multicols}{2}
{\parskip 0pt \tableofcontents}
\end{multicols}
\section{Introduction}
The package \texttt{pst-optexp} is a collection of optical components
that facilitate easy sketching of optical experimental
setups. Mechanisms for proper alignment of different components are
provided internally. This way the user does not have to care for proper
orientation of the elements. Macros for convenient definition of new 
user-defined components are also provided.

\section{Concept and General Behavior}\label{sec:general}

This section introduces into the basic concepts of the package design and
explains the parameters and commands which are supported by most optical
objects.

\subsection{Concept}

The objects provided by \texttt{pst-optexp} can be differentiated into
two different categories: free-ray and fiber-optical objects.

The free-ray units are subdivided in two different kinds: dipoles which
require two reference points for alignment and do not alter the
direction of passing light beams (e.g. lenses and retardation plates)
and tripoles which work in reflection and require three reference points
(mirrors, gratings, beamsplitters etc.).

For free-ray setups one usually has a few straight light paths in which
several different objects are to be arranged. In this case it is very
convenient to define only two nodes for each light path. The objects are
placed on this light path using the different positioning parameters
(see Sec.~\ref{sec:positioning}) of the package. After having arranged
everything, the beams themselves are drawn. If objects with multiple
internal reflections (e.g. prisms, see Sections \ref{sec:doveprism},
\ref{sec:prism} -- \ref{sec:ppprism}) or objects without internal beams
(e.g. optical diodes, see Sec.~\ref{sec:optdiode}) are involved. The
different possibilities are explained in Sec.~\ref{sec:connecting}.

The fiber-optical objects can be classified as dipoles, tripoles and
quadrupoles which have a corresponding number of fiber
connections. Their handling differs in some aspects from the free-ray
objects. The fiber optics are directly connected with the reference
nodes. Every input and output fiber can be flexibly customized for each
object (see Sec.~\ref{sec:styles}). Positioning of the fiber dipoles is
handled equivalently to the free-ray dipoles. Tripoles and quadrupoles
can be found only as different coupler types. Their positioning
mechanisms are a bit more involved and explained in
Sec.~\ref{sec:coupler}.

Some hybrid dipoles (laser, optbox, detector etc.) can be used both as
fiber-optical or free-ray elements. The way they are treated regarding
the connections to the reference points can be controlled by the
parameters explained in Sec.~\ref{sec:connecting}.

\subsection{General Options}

\begin{description}
\paramitem{angle}{<degree>}{0}
\paramitem{optional}{<boolean>}{false}
\paramitem{showoptdots}{<boolean>}{false}
\end{description}

\noindent The parameter \parameter{angle} is available for the macros \cs{optbox}
and \cs{crystal} only, as for the other cases it would make no
sense. It tilts the object relative to the line defined by the two
reference nodes. 

\parameter{optional} can be used with every object and marks it as
optional. The style of an optional element can be configured by changing
the psstyle \parameter{OptionalStyle}.

\parameter{showoptdots} draws some internal nodes which are used to
place the object and the label. The black points are used for
positioning, the red points mark the label references.

\medskip

\begin{LTXexample}[pos=t, vsep=0.8cm]
\begin{pspicture}(12,2)\psgrid
  \psset{beam}
  \optbox[angle=10](0,1)(3,1){box}
  \lens[optional](4,1)(7,1){L}
  \mirror[showoptdots](8,1)(11,1)(11,0){mirror}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Positioning}\label{sec:positioning}

\begin{description}
\paramitem{position}{<num>}{\{\}}
\paramitem{abspos}{<num>}{\{\}}
\end{description}

\noindent\parameter{position} is equivalent to the \parameter{npos}
parameter of \cs{ncput} (can be any number from 0 to 1) and controls the
relative position of object between the two reference points. It it not
available for the free-ray tripoles.

The parameter \parameter{abspos} allows absolute positioning between the
two reference nodes. Its value is given in psunits.

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid 
  \lens[beam, position=0.8](0,1.2)(3,1.2){L}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,1.4)\psgrid 
  \lens[beam, abspos=1](0,1.2)(3,1.2){L}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Labels}\label{sec:labels}

\begin{description}
\paramitem{labeloffset}{<num>}{0.8}
\paramitem{labelangle}{<num>}{0}
\paramitem{labelstyle}{<macro>}{\cs{small}}
\paramitem{labelalign}{<\cs{rput} ref string>}{c}
\paramitem{labelref}{relative|relgrav|global}{relgrav}
\end{description}

\noindent\parameter{labeloffset} specifies the offset from the label 
reference node of the object which is mostly the center. 
\parameter{labelstyle} defines the textstyle that is used to typeset 
the label and \parameter{labelalign} corresponds to the refpoint of 
\cs{rput}. The parameter \parameter{labelref} sets the reference 
coordinate system for the \parameter{labelangle} and the orientation of
the label text. The detailed behaviour is best illustrated looking at
the following three examples.

\medskip

\begin{LTXexample}[width=5cm]
\begin{pspicture}(-2,-2)(2.5,2)
   \multido{\i=0+72}{5}{%
      \optbox[endbox,
              labelref=relative,
              labeloffset=0,
              optboxwidth=1](0,0)(1;\i){\i}
   }
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=5cm]
\begin{pspicture}(-2,-2)(2.5,2)
   \multido{\i=0+72}{5}{%
      \optbox[endbox,
              labelref=relgrav,
              optboxwidth=1](0,0)(1;\i){\i}
   }
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=5cm]
\begin{pspicture}(-2,-2)(2.5,2)
   \multido{\i=0+72}{5}{%
      \optbox[endbox,
              labelref=global,
              optboxwidth=1](0,0)(1;\i){\i}
   }
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Nodes For External Usage}\label{sec:extnode}

\begin{description}
\paramitem{extnode}{<ref string>}{\{\}}
\paramitem{extnodepostfix}{<string>}{ExtNode}
\end{description}

\noindent Some of the objects can provide a supplementary node for additional
connections. A laser diode may be connected for example to a frequency synthesizer
(use package \texttt{pst-circ}) or a detector to a computer.

\parameter{extnode} controls the position of the additional node. By
default this parameter is empty (\texttt{\{\}}) and no node is
created. Possible values are any combinations of \parameter{t}
(top), \parameter{b} (bottom), \parameter{l} (left), \parameter{r}
(right) and \parameter{c} (center).

The name of the new node depends on the \parameter{compname} parameter
(see Sec.~\ref{sec:connecting}). It is composed by \parameter{compname}
+ \parameter{extnodepostfix}, that is if \parameter{compname} is empty
the new node is named \textit{ExtNode} by default and overwritten by
following objects.

Table.~\ref{tab:nodes} shows all objects which provide an external
node. Some allow any combination for \parameter{extnode}, others have
only one reasonable possibility (e.g. piezo mirror, see
Sec.~\ref{sec:mirror}).

\bigskip

\begin{LTXexample}[width=4.5cm]
\begin{pspicture}(4,6)\psgrid 
   \psset{conn=o-o, labeloffset=0}
   \optbox[extnode=t](0,5.5)(4,5.5){\texttt{t}}
   \psdot(ExtNode)
   \optbox[extnode=tr](0,4.5)(4,4.5){\texttt{tr}}
   \psdot(ExtNode)
   \optbox[extnode=b](0,3.5)(4,3.5){\texttt{b}}
   \psdot(ExtNode)
   \optbox[extnode=bl](0,2.5)(4,2.5){\texttt{bl}}
   \psdot(ExtNode)
   \optbox[extnode=l](0,1.5)(4,1.5){\texttt{l}}
   \psdot(ExtNode)
   \optbox[extnode=r](0,0.5)(4,0.5){\texttt{r}}
   \psdot(ExtNode)
\end{pspicture}
\end{LTXexample}

\bigskip

\noindent\begin{minipage}{\textwidth}
  \centering
  \begin{tabular}{llc}
    \toprule
    Object & possible extnode positions &\\
    \midrule
    %
    \cs{optbox} & 
    all (any combination of \texttt{t}, \texttt{r}, \texttt{l} and \texttt{b} &
    \begin{pspicture}[shift=-0.3](0,-0.4)(1,0.4)
       \psframe(0,-0.25)(1,0.25)
       \psdot(0,-0.25)\psdot(0.5,-0.25)\psdot(1,-0.25)
       \psdot(0,0)\psdot(0.5,0)\psdot(1,0)
       \psdot(0,0.25)\psdot(0.5,0.25)\psdot(1,0.25)
    \end{pspicture}\\
    %
    \cs{mirror} & 
    one fix position (only for \parameter{mirrortype=piezo}) &
    \begin{pspicture}[shift=-0.3](1,0.8)
       \mirror[mirrortype=piezo,extnode=t](0,0.4)(0.5,0.4)(0.5,0){}\psdot(ExtNode)
    \end{pspicture}\\
    %
    \cs{optdetector} & 
    one (for \parameter{dettype=round}) &
    \begin{pspicture}[shift=-0.3](1,0.8)
       \optdetector[detsize=0.3, extnode=r](0,0.4)(0.5,0.4){}
       \psdot(ExtNode)
    \end{pspicture}\\
    %
    & all (for \parameter{dettype=diode})& see \cs{optbox}\\
    \cs{optmzm} & all& see \cs{optbox}\\
    \cs{optfilter} & all & see \cs{optbox}\\
    \cs{optswitch} & all & see \cs{optbox}\\
    \cs{fiberdelayline} & all & see \cs{optbox}\\
    \bottomrule
  \end{tabular}
  \captionof{table}{The objects which may provide an external node when parameter
    \texttt{extnode} is not empty. Some allow different positions of the
    node and for some only a fixed node makes sense.}\label{tab:nodes}
\end{minipage}

\subsection{Connecting Objects}\label{sec:connecting}

\begin{description}
\paramitem{compname}{<string>}{\{\}}
\paramitem{conn}{i-i|o-o|f-f}{-}
\item[\param{fiber}:] alias for \parameter{conn=f-f}
\item[\param{beam}:] alias for \parameter{conn=o-i}
\end{description}

\noindent Simple experimental setups with a few objects can usually be
realized by defining some nodes, arranging the object inbetween and
drawing the beams at the end. If, however, objects with multiple
internal reflections (all the prisms) or without visible internal beams
(optical diode) are involved, this simple method is not applicable
anymore.

For this case several different possibilities of connecting objects are
available: parameter{conn} specifies the kind of connections before and
after the object. Its syntax is analogous to the PSTricks
parameter \parameter{arrows}. By default it is set to \texttt{-} and no
connections are drawn. 

All fiber-optical units define \parameter{conn=f-f} which means that
input and output connections are \texttt{f}ibers (the boolean
parameter \parameter{fiber} is an alias for \parameter{conn=f-f}). The
other possibilities are \parameter{i} (inner node) and \parameter{o}
(outer node). Their meaning should become clear looking at the next two
code examples. The letter before the dash specifies the kind of
connection from the first reference node to the
object. A \parameter{conn=o-} connects the first reference node to the
outer left node, a \parameter{conn=i-} connects the first reference node
to the outer left node and then a line through all internal nodes up to
the outer right node. Equivalently does \parameter{conn=-i}
and \parameter{conn=-o} work for the second reference point. The boolean
parameter \parameter{beam} is an alias for \parameter{conn=o-i}. The
beam style is controlled by the psstyle \parameter{Beam} which can be
changed using \parameter{newpsstyle} and \parameter{addtopsstyle}.

\medskip

\begin{LTXexample}[width=4.5cm]
\begin{pspicture}(4,6)\psgrid
  \addtopsstyle{Beam}{arrows=->, arrowscale=1.5}
  \psset{labeloffset=0.1, labelalign=t}
  \optbox[conn=o-](0,5)(4,5){\texttt{o-}}
  \optbox[conn=i-](0,4)(4,4){\texttt{i-}}
  \optbox[conn=-o](0,3)(4,3){\texttt{-o}}
  \optbox[conn=-i](0,2)(4,2){\texttt{-i}}
  \optbox[conn=-f](0,1)(4,1){\texttt{-f}}
\end{pspicture}
\end{LTXexample}

\medskip

\begin{LTXexample}[width=4.5cm]
\begin{pspicture}(4,5)\psgrid
  \addtopsstyle{Beam}{arrows=->, arrowscale=1.5}
  \psset{labeloffset=0}
  \doveprism[conn=o-](0,4)(4,4){\texttt{o-}}
  \doveprism[conn=i-](0,3)(4,3){\texttt{i-}}
  \doveprism[conn=-o](0,2)(4,2){\texttt{-o}}
  \doveprism[conn=-i](0,1)(4,1){\texttt{-i}}
\end{pspicture}
\end{LTXexample}

\medskip 

The following example shows how this parameter can be used in some kinds
of experimental setups using objects with internal reflections (here a
penta prism). Instead of drawing the beam at the end with a \cs{psline},
the beams are created at definition time of the object with
the \parameter{conn} parameter.

\begin{LTXexample}[width=4.5cm]
\begin{pspicture}(4,6)\psgrid
   \pnode(1,1.5){A}\pnode(1,5){G}\pnode(3,5){B}
   \optbox[endbox, labelref=relative, labeloffset=0](G)(A){Laser}
   \lens[lens=0.5 0.5 0.5, abspos=0.5](A)(G){}
   \pinhole[abspos=0.7](A)(G){}
   \lens[lens=2, abspos=1](A)(G){}
   \lens[abspos=2.5, labelangle=180](A)(G){L}
   \lens[abspos=1](G)(B){L}
   \optbox[endbox, labeloffset=0, optboxwidth=1](G)(B){CCD}
   \pentaprism[beam, labeloffset=1](A)(G)(B){PP}
\end{pspicture}
\end{LTXexample}

\medskip

This method works as long as no objects without internal beams or with
internal reflections (e.g. a Dove prism, see Sec.~\ref{sec:doveprism})
are used in the setup. A possibility would be to create additional
nodes, but this may be not very comfortable. Therefore,
\texttt{pst-optexp} provides a macro \cs{drawbeam} which connect a named
objects with a node or another named object. A named object is a
\texttt{pst-optexp} element with a non-empty \parameter{compname}.

\medskip

\begin{lstlisting}
\drawbeam[conn=...]{<from>}{<to>}
\end{lstlisting}

\medskip

\noindent If \parameter{<from>} or \parameter{<to>} is a node, it must be written
including the round braces. A call

\medskip

\begin{lstlisting}
\drawbeam{Obj}{(1;45)}
\end{lstlisting}

\medskip\noindent connects an named object \parameter{Obj} to a node.

The type of beam connection is again controlled by the
parameter \parameter{conn}. Almost every optical object does not have
distinguished inputs and outputs and can be used in either
directions. Therefore, it does not make sense to speak about `input` and
`output` when referring to the object nodes, but rather about node A and
node B. Consequently, the two letters of parameter \parameter{conn} can
take the values \parameter{a}, \parameter{A}, \parameter{b}
or \parameter{B} when used together with \cs{drawbeam}.

The first letter in \parameter{conn} refers to the \parameter{<from>}
object, the second one to the \parameter{<to>} object.

\medskip

\begin{LTXexample}[width=4.5cm]
\begin{pspicture}(4,6)\psgrid
  \doveprism[compname=Dove1](0,1)(3,1){Dove1}
  \drawbeam[conn=b-]{Dove1}{(3,1)}
  \doveprism[compname=Dove2](0,3)(3,3){Dove2}
  \drawbeam[conn=B-]{Dove2}{(3,3)}
\end{pspicture}
\end{LTXexample}

\begin{LTXexample}[width=4.5cm]
\begin{pspicture}(4,6)\psgrid
   \pnode(1,1.5){A}\pnode(1,5){G}\pnode(3,5){B}
   \optbox[endbox, labelref=relative, labeloffset=0](G)(A){Laser}
   \lens[lens=0.5 0.5 0.5, abspos=0.5](A)(G){}
   \pinhole[abspos=0.7](A)(G){}
   \lens[lens=2, abspos=1](A)(G){}
   \lens[abspos=2.5, labelangle=180](A)(G){L}
   \lens[abspos=1](G)(B){L}
   \optdiode[abspos=1.8, conn=o-, compname=OD](A)(G){OD}
   \optbox[endbox, labeloffset=0, optboxwidth=1](G)(B){CCD}
   \addtopsstyle{Beam}{linecolor=blue}
   \pentaprism[conn=-i, labeloffset=1, compname=PP](A)(G)(B){PP}
   \addtopsstyle{Beam}{linecolor=red}
   \drawbeam[conn=b-a]{OD}{PP}
\end{pspicture}
\end{LTXexample}

\newpage

\section{Free-Ray Objects}

In the sections \ref{sec:lens}--\ref{sec:custom} the
available free-ray components with their parameters are described.

In section \ref{sec:general} general parameters are described that are
not proprietary to a specific unit but can be used for several different
components. Finally, in section \ref{sec:labels} the options for the
positioning of labels are explained.

The appearence of all components can be changed with the corresponding
standard PSTricks parameters such as \parameter{fillstyle}
or \parameter{linestyle}. For some components changing only parts of the
layout is possible (e.g. the extended part of mirrors). For those cases
psstyles are provided that influence only the corresponing part of the
components and can be redefined using \cs{newpsstyle}.

\subsection{Lens}\label{sec:lens}

\begin{description}
\paramitem{lensheight}{<num>}{1}
\paramitem{lenswidth}{<num>}{0.3}
\paramitem{lensradius}{<num> [<num>]}{\{\}}
\paramitem{lensradiusleft}{<num>}{1}
\paramitem{lensradiusright}{<num>}{1}
\paramitem{lens}{<num> [<num> [<num> [<num>]]]}{\{\}}
\paramitem{thicklens}{<boolean>}{false}
\end{description}

\medskip 

\begin{LTXexample}[width=5.5cm]
\begin{pspicture}(5,6)\psgrid
  % concave lenses
  \pnode(0,5){A}\pnode(5,5){B}
  \psline[style=Beam](A)(B)
  \lens[position=0.2](A)(B){L}
  \lens[lensradius=-1,position=0.5](A)(B){L}
  \lens[lens=-1.5 1,position=0.7](A)(B){L}
  % convex lenses
  \pnode(0,3){A}\pnode(5,3){B}
  \psline[style=Beam](A)(B)
  \lens[position=0.2,lens=1 -1](A)(B){L}
  \lens[lens=0 -1](A)(B){L}
  \lens[lens=1 0,position=0.7](A)(B){L}
  % thick lenses
  \pnode(0,1){A}\pnode(5,1){B}
  \psline[style=Beam](A)(B)
  \lens[position=0.3, lens=-1.5 1 1 0.5, thicklens](A)(B){thicklens}
  \lens[lens=0 -1, position=0.7, fillstyle=solid, fillcolor=blue!30!white](A)(B){lens}
\end{pspicture}
\end{LTXexample}

\medskip

The shape of a lens is defined by its two surface radii. A negative
radius gives a concave, a positive radius a convex and a radius of
\texttt{0} a plain surface. The parameters \parameter{lensradiusleft}
and \parameter{lensradiusright} allow to define independent values for both
surfaces. \parameter{lensradius} sets both curvatures to the same
value. Usually only \parameter{lensheight} and the two radii are used to
construct the lens. The thickness (or width) is determined
automatically. Manually controlling the thickness of the lens can be
achived by setting \parameter{thicklens}
to \parameter{true}. Then \parameter{lenswidth} is used as width of the lens at
its waist. Finally, the parameter \parameter{lens} allows the definition of
all relevant lens parameters at once. It consists of one up to four
space-separated numbers. The first one gives the left radius. If no
further value is set, the right radius will be set to the same value and
all other parameters are left unchanged. Using two numbers defines two
different radii. The third optional value defines
the \parameter{lensheight} and the fourth one the \parameter{lenswidth}

\textbf{Compatibility:} The whole implementation of the lens was
changed in version 1.2. It allows a much more flexible definition of different lens
types. However, I could not get full compatibility with the older way to
define lens using only \parameter{lensheight} and \parameter{lenswidth}. To use
this old behaviour, you have to set the \parameter{lenstype} explicitly, but
then you have no access to the new features! All users are encouraged to
adapt their code to use the new parameters, as the old code will be
removed in future versions.

\medskip
\subsection{Optical Plate}

\begin{description}
\paramitem{plateheight}{<num>}{1}
\paramitem{platelinewidth}{<num>}{2\cs{pslinewidth}}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optplate[beam](0,1.2)(3,1.2){filter}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Retardation Plate}

\begin{description}
\paramitem{plateheight}{<num>}{1}
\paramitem{platewidth}{<num>}{0.1}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \pnode(0,1.2){A}
  \pnode(3,1.2){B}
  \optretplate[beam](A)(B){$\nicefrac{\lambda}{2}$}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Pinhole}

\begin{description}
\paramitem{outerheight}{<num>}{1}
\paramitem{innerheight}{<num>}{0.1}
\paramitem{phlinewidth}{<num>}{2\cs{pslinewidth}}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \pnode(0,1.2){A}
  \pnode(3,1.2){B}
  \pinhole[beam](A)(B){PH}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Crystal}\label{sec:crystal}

\begin{description}
\paramitem{crystalwidth}{<num>}{2}
\paramitem{crystalheight}{<num>}{0.8}
\paramitem{caxislength}{<num>}{0.6}
\paramitem{caxisinv}{<boolean>}{false}
\paramitem{voltage}{<boolean>}{false}
\paramitem{lamp}{<boolean>}{false}
\paramitem{lampscale}{<num>}{0.3}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \pnode(0,1.2){A}
  \pnode(3,1.2){B}
  \crystal[crystalwidth=1.5, crystalheight=0.6, fillstyle=solid, fillcolor=yellow!90!black, labelangle=-45, labeloffset=1.2, voltage, lamp, beam](A)(B){SBN:Ce}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Box}

\begin{description}
\paramitem{optboxheight}{<num>}{0.5}
\paramitem{optboxwidth}{<num>}{1}
\paramitem{endbox}{<boolean>}{false}
\end{description}

\medskip 

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optbox[beam](0,0)(3,2){box}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optbox[beam, endbox](0,0)(1.7,1){box}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \pnode(0,0){A}
  \pnode(1.7,1){B}
  \optbox[beam, endbox, labelref=relative, labeloffset=0](A)(B){box}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Detector}

\begin{description}
\paramitem{detsize}{<num>}{0.5}
\paramitem{dettype}{round|diode}{round}
\end{description}

\medskip 

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \pnode(0,0){A}
  \pnode(1.7,1){B}
  \optdetector[beam](A)(B){detector}
\end{pspicture}
\end{LTXexample}

\bigskip 

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \pnode(0,0){A}
  \pnode(1.7,1){B}
  \optdetector[beam, dettype=diode](A)(B){detector}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Optical Diode}\label{sec:optdiode}

\begin{description}
\paramitem{optdiodesize}{<num>}{0.8}
\end{description}

\medskip 

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
   \optdiode[conn=o-o](0,1)(3,1){Diode}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Dove Prism}\label{sec:doveprism}
\begin{description}
  \paramitem{doveprismsize}{<num>}{1}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \doveprism[beam](0,1)(3,1){Dove}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Polarization}

\begin{description}
\paramitem{poltype}{parallel|perp|misc|lcirc|rcirc}{parallel}
\paramitem{polsize}{<num>}{0.6}
\paramitem{pollinewidth}{<num>}{0.7\cs{pslinewidth}}
\end{description}

\medskip

\begin{LTXexample}[width=3.4cm]
\begin{pspicture}(3,5)\psgrid
  \pnode(0,0.5){A1}\pnode(3,0.5){B1}\pnode(0,1.5){A2}
  \pnode(3,1.5){B2}\pnode(0,2.5){A3}\pnode(3,2.5){B3}
  \pnode(0,3.5){A4}\pnode(3,3.5){B4}\pnode(0,4.5){A5}
  \pnode(3,4.5){B5}\psset{style=Beam}
  \multido{\i=1+1}{5}{\psline(A\i)(B\i)}
  \psset{linecolor=black}
  \polarization[poltype=misc,position=0.2](A5)(B5)
  \polarization[poltype=perp,position=0.35](A4)(B4)
  \polarization[poltype=parallel,position=0.5](A3)(B3)
  \polarization[poltype=rcirc,position=0.65](A2)(B2)
  \polarization[poltype=lcirc,position=0.8](A1)(B1)
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Mirror}\label{sec:mirror}

\begin{description}
\paramitem{mirrorwidth}{<num>}{1}
\paramitem{mirrorradius}{<num>}{0}
\paramitem{mirrorlinewidth}{<num>}{2\cs{pslinewidth}}
\paramitem{mirrortype}{normal|piezo|extended}{normal}
\paramitem{mirrordepth}{<num>}{0.08}
\paramitem{variable}{<num>}{false}
\end{description}

The parameter \texttt{mirrorradius} defines the curvature of the mirror. A
value of \texttt{0} is for a plain mirror, a negative radius is for a
concave mirror and a positive radius gives you a convex mirror. The
style of the extended mirror is defined as a
psstyle \parameter{ExtendedMirror} and can be changed using
\cs{newpsstyle}. The appearence of the piezo mirror likewise can be
changed by adapting the psstyle \parameter{PiezoMirror}.

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,0){A}
  \pnode(1.8,2.2){G}
  \pnode(0,3){B}
  \mirror[beam](A)(G)(B){mirror}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,0){A}
  \pnode(1.8,2.2){G}
  \pnode(0,3){B}
  \mirror[beam, variable](A)(G)(B){M$_\mathrm{var}$}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,0){A}
  \pnode(1.8,2.2){G}
  \pnode(0,3){B}
  \mirror[beam, mirrortype=piezo,labelangle=-90](A)(G)(B){piezo}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,0){A}
  \pnode(1.8,2.2){G}
  \pnode(0,3){B}
  \mirror[beam, mirrortype=extended](A)(G)(B){M$_\mathrm{ext}$}
\end{pspicture}
\end{LTXexample}

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,0){A}\pnode(0.7,2){G1}
  \pnode(1.5,1){G2}\pnode(2,3){B}
  \psset{labeloffset=0.5}
  \psline[style=Beam](A)(G1)(G2)(B)
  \mirror[mirrortype=extended, mirrorradius=1](A)(G1)(G2){M$_v$}
  \mirror[mirrorradius=-1](G1)(G2)(B){M$_x$}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Beamsplitter}

\begin{description}
\paramitem{bssize}{<num>}{0.8}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,2){A}
  \pnode(2,2){G}
  \pnode(3,0){B}
  \beamsplitter[beam](A)(G)(B){BS}
\end{pspicture}
\end{LTXexample}

\medskip


\subsection{Optical Grid}

\begin{description}
\paramitem{optgridcount}{<integer>}{10}
\paramitem{optgridwidth}{<num>}{1}
\paramitem{optgridheight}{<num>}{0.1}
\paramitem{optgriddepth}{<num>}{0.05}
\paramitem{optgridtype}{blazed|binary}{blazed}
\paramitem{optgridlinewidth}{<num>}{0.7\cs{pslinewidth}}
\paramitem{reverse}{<boolean>}{false}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,3){A}
  \pnode(1.8,2.2){G}
  \pnode(0,0){B}
  \optgrid[beam](A)(G)(B){grid}
\end{pspicture}
\end{LTXexample}

\bigskip


\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,3){A}
  \pnode(1.8,2.2){G}
  \pnode(0,0){B}
  \optgrid[beam, reverse](A)(G)(B){grid}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,3){A}
  \pnode(1.8,2.2){G}
  \pnode(0,0){B}
  \optgrid[beam,%
           optgridcount=6,%
           optgriddepth=0.2,%
           optgridheight=0.3](A)(G)(B){grid}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,3){A}
  \pnode(1.8,2.2){G}
  \pnode(0,0){B}
  \optgrid[beam, optgridtype=binary](A)(G)(B){grid}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Prism}\label{sec:prism}
\begin{description}
  \paramitem{prismsize}{<num>}{1}
  \paramitem{prismangle}{<num>}{60}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,2.5){A}
  \pnode(2,2){G}
  \pnode(3,0){B}
  \optprism[beam](A)(G)(B){Prism}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Right-Angle Prism}\label{sec:raprism}
\begin{description}
  \paramitem{raprismsize}{<num>}{1}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,2.3){A}
  \pnode(1.8,2){G}
  \pnode(0,1.7){B}
  \rightangleprism[beam](A)(G)(B){RA}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Penta Prism}\label{sec:ppprism}
\begin{description}
  \paramitem{pentaprismsize}{<num>}{1}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,2.3){A}
  \pnode(2.3,2.3){G}
  \pnode(2.3,0){B}
  \pentaprism[beam](A)(G)(B){PP}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Custom Components}\label{sec:custom}
The macros \cs{optdipole} and \cs{opttripole} allow using everything as
optical component. If you want to use a certain component several times,
you should define it as a new component. For details see
sec.~\ref{sec:newobj}.

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,2){A}
  \pnode(3,1){B}
  \optdipole[labeloffset=1](A)(B){%
    \rput(0,0){%
      \includegraphics[scale=0.25]{parque-nacional}
    }
  }{label}
  \psline[linecolor=red](A)(B)
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
  \pnode(0,0){A}
  \pnode(1.5,2){G}
  \pnode(3,1.5){B}
  \opttripole(B)(G)(A){\rput[b](0,0){text}}{label}
  \psline[linecolor=red](A)(G)(B)
\end{pspicture}
\end{LTXexample}

\newpage

\section{Fiber-Optical Objects}

\subsection{Fiber}
\begin{description}
\paramitem{fiberloops}{<integer>}{3}
\paramitem{fiberloopradius}{<num>}{0.3}
\paramitem{fiberloopsep}{<num>}{0.3}
\end{description}
\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optfiber(0,1)(3,1){SSMF}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Amplifier}
\begin{description}
\paramitem{optampsize}{<num>}{0.8}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optamp(0,1)(3,1){EDFA}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Mach-Zehnder Modulator}
\begin{description}
\paramitem{optmzmsize}{<num>}{0.8}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optmzm(0,1)(3,1){MZM}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Filter}
\begin{description}
\paramitem{filtersize}{<num>}{0.8}
\paramitem{filtertype}{bandpass|bandstop}{bandpass}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optfilter(0,1)(3,1){bandpass}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optfilter[filtertype=bandstop](0,1)(3,1){bandstop}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Polarization Controller}
\begin{description}
\paramitem{polcontrolsize}{<num>}{0.1}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \polcontrol(0,1)(3,1){PC}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Optical Switch}
\begin{description}
\paramitem{switchsize}{<num>}{0.8}
\paramitem{switchstyle}{opened|closed}{opened}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optswitch(0,1)(3,1){Opened switch}
\end{pspicture}
\end{LTXexample}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optswitch[switchstyle=closed](0,1)(3,1){Closed switch}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Fiber Delay Line}

\begin{description}
  \paramitem{fdlsize}{<num>}{0.8}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \fiberdelayline(0,1)(3,1){Delay line}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Fiber Collimator}

\begin{description}
\paramitem{fibcolsize}{<num>}{0.4}
\end{description}

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
   \fibercollimator(0.5,1)(2.5,1){FC}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Coupler}\label{sec:coupler}
\begin{description}
\paramitem{couplersize}{<num>}{0.1}
\paramitem{couplersep}{<num>}{0.1}
\paramitem{couplertype}{none|elliptic}{elliptic}
\end{description}

\medskip
\subsubsection{\texorpdfstring{$2\times 2$}{2x2} Coupler}

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optcoupler(0.5,2)(0,0.5)(3,1.5)(2.5,0){Coupler}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optcoupler[align=top](0.5,2)(0,0.5)(3,1.5)(2.5,0){Coupler}
\end{pspicture}
\end{LTXexample}

\bigskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \optcoupler[align=bottom, couplertype=none](0.5,2)(0,0.5)(3,1.5)(2.5,0){Coupler}
\end{pspicture}
\end{LTXexample}

\medskip

\subsubsection{WDM Coupler}

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \wdmcoupler[align=bottom](0,1.5)(0,0.5)(3,0.5){WDM}
\end{pspicture}
\end{LTXexample}

\medskip

\subsubsection{WDM Splitter}
\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
  \newpsstyle{FiberOut2}{style=Fiber, arrows=->}
  \wdmsplitter[align=top](0,1.5)(3,1.5)(3,0.5){}
\end{pspicture}
\end{LTXexample}

\medskip

\subsection{Fiber Styles}\label{sec:styles}

\begin{description}
\paramitem{usefiberstyle}{<boolean>}{true}
\paramitem{Fiber}{<psstyle>}{linecolor=red}
\paramitem{FiberIn}{<psstyle>}{style=Fiber}
\paramitem{FiberIn1}{<psstyle>}{style=FiberIn}
\paramitem{FiberIn2}{<psstyle>}{style=FiberIn}
\paramitem{FiberOut}{<psstyle>}{style=Fiber}
\paramitem{FiberOut1}{<psstyle>}{style=FiberOut}
\paramitem{FiberOut2}{<psstyle>}{style=FiberOut}
\end{description}

All these psstyles control the appearence of the fiber parts before and
after each components. The styles can be redefined with \cs{newpsstyle}
or changed with \cs{addtopsstyle}.  For optical systems it is not
possible to define a unique input and a unique output as most components
can be used bidirectionally. Therefore, I refer to the input as the part
from the first node to the component and to the output as the part from
the component to the second node.

The basic style is \parameter{Fiber} which is the parent of all other
styles. \parameter{FiberIn} inherits from \parameter{Fiber} and defines
the style of the input fiber. Analogously \parameter{FiberOut} controls
the style of the output fiber. If you want to change the input and
output fiber styles you should use \cs{addtopsstyle} as then the
inheritance from the parent style \parameter{Fiber} remains.

The other styles are used by the fiber couplers (\cs{optcoupler},
\cs{wdmcoupler} and \cs{wdmsplitter}). \parameter{FiberIn1} affects the
upper input fiber, \parameter{FiberIn2} the lower input
fiber, \parameter{FiberOut1} the upper output fiber
and \parameter{FiberOut2} the lower output fiber. If the object has only
one input (e.g. \cs{wdmsplitter}), \parameter{FiberIn} is used.

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,3)\psgrid
   \addtopsstyle{FiberIn}{ArrowInside=->, arrowscale=1.2}
   \addtopsstyle{FiberOut2}{linecolor=blue}
   \optcoupler(0,2.5)(0,0.5)(3,2.5)(3,0.5){50~\%}
\end{pspicture}
\end{LTXexample}

\medskip

In addition to the psstyles there exist
corresponding \parameter{new\ldots} and \parameter{addto\ldots}
parameter keys for each of them.

\medskip

\begin{lstlisting}
\psset{addtoFiberIn={arrows=->, arrowscale=1.3}}
\end{lstlisting}

\medskip

\noindent is equivalent to 

\medskip

\begin{lstlisting}
\addtopsstyle{FiberIn}{arrows=->, arrowscale=1.3}
\end{lstlisting}

\medskip

\noindent Accordingly \parameter{newFiberIn} corresponds to \cs{newpsstyle\{FiberIn\}\{\ldots\}}.

At first glance these keys make no sense. The reason why I
introduced them was to be able to define special couplers with
\cs{newpsobject}. This is only possible if all modifications can be
expressed as parameter keys. Consider for example a WDM splitter which
only couples out a certain spectral range of the input and you want to
mark the output with an arrow:

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
   \newpsobject{mywdmsplitter}{wdmsplitter}{addtoFiberOut1={arrows=->, arrowscale=1.3, linecolor=blue}, labelangle=180, align=bottom}
   \mywdmsplitter(0,0.5)(3,1.5)(3,0.5){blue band}
\end{pspicture}
\end{LTXexample}

\medskip

Or if you need a coupler with a particular input angle you can do it be extending the appropriate fiber style:

\medskip

\begin{LTXexample}[width=3.5cm]
\begin{pspicture}(3,2)\psgrid
   \newpsobject{mycoupler}{optcoupler}{addtoFiberIn2={angleA=90}, align=top}
   \mycoupler(0.5,1.5)(0.5,0.5)(2.5,1.5)(2.5,0.5){}
\end{pspicture}
\end{LTXexample}

\newpage

\section{Defining New Objects}

\subsection{Customized Versions of Existing Macros}

The easiest way to define your own components is to use the
\cs{newpsobject} macro. With this you can define a new component using
predefined objects with a set of options. These options serve only as
default values and can be overridden. The following examples defines a
new object \cs{sbn} for the special crystal used in
Sec.~\ref{sec:crystal}.

\medskip

\begin{LTXexample}[width=3.5cm]
\newpsobject{sbn}{crystal}{crystalwidth=1.5, crystalheight=0.6, voltage, lamp, labelangle=45, labeloffset=1.2, fillstyle=solid, fillcolor=yellow!90!black}
\begin{pspicture}(3,2)\psgrid 
   \sbn(0,1)(3,1){SBN:Ce}
   \psline[style=Beam](0,1)(3,1)
\end{pspicture}
\end{LTXexample}

\medskip

\begin{LTXexample}[width=3.5cm]
\newpsobject{pumpcoupler}{wdmcoupler}{align=top, labelangle=180, addtoFiberIn2={ArrowInside=->, arrowscale=2}}
\begin{pspicture}(3,2)\psgrid 
   \pumpcoupler(0,1)(0,0)(3,1){Pumpcoupler}
\end{pspicture}
\end{LTXexample}

\medskip

If you need more than one type of lenses in your setup it is very cumbersome to specify all parameters every time.

\medskip

\begin{LTXexample}[width=5.5cm]
\newpsobject{MOLensIn}{lens}{lens=0.5 0.5 0.5}
\newpsobject{MOLensOut}{lens}{lens=1.5 1.5 1.5}
\begin{pspicture}(5,2)\psgrid 
   \pnode(0,1){A}\pnode(5,1){B}
   \MOLensIn[abspos=0.5](A)(B){}
   \MOLensOut[abspos=1](A)(B){}
   \MOLensOut[abspos=4](A)(B){}
   \MOLensIn[abspos=4.5](A)(B){}
   \psline[style=Beam](A)(B)
\end{pspicture}
\end{LTXexample}
\medskip

\subsection{Defining New Objects}\label{sec:newobj}

Since version 1.2 \texttt{pst-optexp} provides some high-level macros to
allow very convenient definition of completely new components. The macro
\cs{newOptexpDipole} generates all organizing code for a new free-ray
component. All you have to do is to define a new "`drawing"' macro
\cs{mycomponent@iii} which contains all drawing code. Analogously
\cs{newOptexpDipoleNolabel} defines a new free-ray object which takes no label
(like \cs{polarization}) and \cs{newOptexpTripole} defines a new
reflective component. 

New fiber-optical components can be defined using
\cs{newOptexpFiberDipole}. This macro differs from its free-ray
analogous only in that it presets \parameter{fiber} and hence directly
connects the component with the nodes. The first node in the parameter
list gets connected with a node \parameter{tempNode@A@}, the second node
with a node \parameter{tempNode@B@}. These two internal nodes are preset
to \parameter{(0,0)} and can be overwritten within the drawing macro.

The syntax of the macros is
\begin{lstlisting}
\newOptexpDipole[fixed options]{name}{default options}
\newOptexpDipoleNolabel[fixed options]{name}{default options}
\newOptexpTripole[fixed options]{name}{default options}
\newOptexpFiberDipole[fixed options]{name}{default options}
\end{lstlisting}
The \texttt{default options} are simply a list of PSTricks parameters
which are taken as defaults for the new component. The optional argument
allows setting of parameters which cannot be overridden later.

This is illustrate a bit more in the next code snippet, which also shows
how the coordinate system is handled withing the \cs{mycomponent@iii}
macro.

\medskip

\begin{LTXexample}[width=4.5cm]
\newOptexpTripole{mygrid}{subgriddiv=5, griddots=0, subgridwidth=\pslinewidth, gridwidth=2\pslinewidth}
\makeatletter
\def\mygrid@iii{% put here all PSTricks drawing code
  \psgrid(-1,0)(1,1)
}%
\makeatother
\begin{pspicture}(4,4)\psgrid 
   \pnode(0,1){A}\pnode(2,2){G}\pnode(3,0){B}
   \mygrid[gridcolor=red,labeloffset=1.5](A)(G)(B){myGrid}
   \psline[style=Beam](A)(G)(B)
\end{pspicture}
\end{LTXexample}
\medskip

The default position of the label reference point is (0,0). If you want
to change this, you have to define a new pnode named
\texttt{tempNode@Label} in the \cs{mycomponent@iii} macro.

If you create a new component, please send it to me then I can
incorporate this in a new released version.

\newpage

\section{Examples}
\psset{unit=1.2cm}
\begin{LTXexample}[pos=t,vsep=8mm]
\begin{pspicture}(0,0.2)(12,1.8)
\pnode(0,1.2){Start}\pnode(11,1.2){CCD}
\psline[linewidth=2\pslinewidth,style=Beam](Start)(CCD)
\polarization[poltype=perp,position=0.1](Start)(CCD)
\optretplate[position=0.15](Start)(CCD){$\nicefrac{\lambda}{2}$}
\lens[lensheight=0.5,
      lensradius=0.5,
      position=0.25](Start)(CCD){$L_1$}
\lens[position=0.5](Start)(CCD){$L_2$}
\optplate[position=0.57, platelinewidth=3\pslinewidth](Start)(CCD){SLM}
\optplate[position=0.63](Start)(CCD){PF}
\polarization[position=0.66](Start)(CCD)
\lens[position=0.7](Start)(CCD){$L_3$}
\optbox[endbox,labeloffset=0](Start)(CCD){CCD}
\end{pspicture}
\end{LTXexample}

\vspace{\fill}

\begin{LTXexample}[pos=t,vsep=8mm]
\begin{pspicture}(-4,-1)(3,3)
  \psset{labeloffset=0.5}
  \pnode(-2,0){LaserOut}
  \pnode(0,0){Grid}
  \pnode(4;45){Out}
  \pnode(2.5;67.5){Mvar}
  \psline[linewidth=2\pslinewidth,
         linecolor=red!90!black](LaserOut)(Grid)(Out)\psline(Grid)(Mvar)
  \optbox[endbox, optboxwidth=2, labeloffset=0](Grid)(LaserOut){diodelaser}
  \optretplate[position=0.3, labeloffset=0.8](LaserOut)(Grid){$\nicefrac{\lambda}{4}$}
  \optgrid(LaserOut)(Grid)(Out){grid}
  \mirror[variable](Grid)(Mvar)(Grid){M$_\mathrm{var}$}
\end{pspicture}
\end{LTXexample}

\begin{LTXexample}[pos=t,vsep=3mm]
\begin{pspicture}(0,-0.4)(9,6)
  \pnode(1.5,5){Laser}\pnode(4,5){PBS}\pnode(6.5,5){PBS2}
  \pnode(6.5,5.7){piezo}\pnode(4,2){BSFwd}\pnode(6.5,2){BSBwd}
  \pnode(2,2){BS4f}\pnode(2,0.5){M4f3}\pnode(8,2){M4f1}
  \pnode(8,0.5){M4f2}\pnode(1,2){CCD}
  \psline[style=Beam,linewidth=2\pslinewidth]%
         (Laser)(PBS2)(piezo)(BSBwd)(M4f1)(M4f2)(M4f3)(BS4f)(CCD)
  \psline[style=Beam,linewidth=2\pslinewidth](PBS)(BSFwd)(BS4f)
  \psset{mirrorwidth=0.6, plateheight=0.7, outerheight=0.7, labeloffset=0.7, labelstyle=\scriptsize, lensheight=0.8, lenswidth=0.2, bssize=0.5} 
  \optbox[endbox,optboxwidth=1.5, optboxheight=0.7,labeloffset=0]%
     (PBS)(Laser){\parbox{1.5cm}{\centering Nd:YAG\\ 532\,nm}}
  \lens[lensheight=0.5, position=0.2](Laser)(PBS){MO}
  \pinhole[position=0.3,labelangle=180](Laser)(PBS){PH}
  \lens[position=0.5](Laser)(PBS){L}
  \optretplate[position=0.8](Laser)(PBS){$\nicefrac{\lambda}{2}$}
  \beamsplitter(Laser)(PBS)(BSFwd){PBS}
  \optretplate[position=0.4](PBS)(BSFwd){$\nicefrac{\lambda}{2}$}
  \polarization(PBS)(BSFwd)\polarization(PBS2)(BSBwd)
  \lens[position=0.8](PBS)(BSFwd){L}
  \optretplate(PBS)(PBS2){$\nicefrac{\lambda}{2}$}
  \beamsplitter(PBS)(PBS2)(piezo){PBS}
  \optretplate[abspos=0.5](PBS2)(piezo){$\nicefrac{\lambda}{4}$}
  \mirror[mirrortype=piezo,labelangle=90](PBS2)(piezo)(PBS2){PZ}
  \lens[position=0.8,labelangle=180](PBS2)(BSBwd){L}
  \beamsplitter(PBS)(BSFwd)(BSBwd){BS}
  \beamsplitter[labelangle=-90](PBS2)(BSBwd)(BSFwd){BS}
  \crystal[crystalwidth=1, crystalheight=0.5, voltage, lamp, fillstyle=solid, fillcolor=yellow!90!black, labeloffset=0.8](BSFwd)(BSBwd){SBN:Ce}
  \mirror(BSBwd)(M4f1)(M4f2){M}\mirror(M4f1)(M4f2)(M4f3){M}
  \lens[labelangle=180](M4f2)(M4f3){L}\mirror(M4f2)(M4f3)(BS4f){M}
  \beamsplitter(M4f3)(BS4f)(CCD){BS}\optbox[endbox,labeloffset=0](BS4f)(CCD){CCD}
  \lens[abspos=0.7](BS4f)(BSFwd){L}\lens[abspos=0.7](BSBwd)(M4f1){L}
  \psline[style=Beam, linewidth=2\pslinewidth](BSFwd)(BSBwd)
\end{pspicture}
\end{LTXexample}

The following schematic configuration of a recirculating loop was
adapted from the publication N. Kikuchi, S. Sasaki and K. Sekine, "`10
Gbit/s dispersion-compensated transmission over 2245~km conventional
fibres in a recirculating loop"', Electron. Lett. 31 (\textbf{5}), 375
(1995).

\begin{LTXexample}[pos=t]
\psset{unit=1cm}
\begin{pspicture}(0.5,4)(13.2,10.5)
  \laser[labeloffset=0](2.1,10)(2,10){LD}
  \optmzm(2.1,10)(3.5,10){MZM}
  \optamp(3.5,10)(4.5,10){EDFA}
  \optfilter(4.5,10)(5.5,10){BPF}
  \optswitch(5.5,10)(6.5,10){SW}
  \polcontrol(6.5,10)(7.5,10){}
  \optcoupler[couplertype=none,couplersep=0.2](7.5,10)(7.5,8)(9,10)(9,8){}
  \optamp(9,10)(10.5,10){EDFA}
  \optfilter(10.5,10)(12,10){BPF}
  \optbox[endbox, labeloffset=0, conn=f-f](12,10)(12.1,10){RX}
  % loop
  \optamp(9,8)(11,8){EDFA}
  \psline[linearc=1,style=Fiber](11,8)(12,8)(12,4.5)(11,4.5)
  \optfiber[labelalign=b, labeloffset=-1, position=0.8](9,4.5)(11,4.5){\begin{tabular}{c}conventional\\fibre 89.8~km\end{tabular}}
  \optamp(9,4.5)(8,4.5){EDFA}
  \optfilter(8,4.5)(6.5,4.5){BPF}
  \optfiber[fiberloops=1, labeloffset=-1, labelalign=b](4,4.5)(6.5,4.5){DCF 16.2~km}
  \optamp(4,4.5)(2.5,4.5){EDFA}
  \psline[style=Fiber,linearc=1](2.5,4.5)(1.5,4.5)(1.5,8)(2.5,8)
  \optfilter(2.5,8)(4.5,8){BPF}
  \optswitch(4.5,8)(6,8){SW}
  \polcontrol(6,8)(7.5,8){}
\end{pspicture}
\end{LTXexample}

\newpage

\section{Complete List of Parameters}
\begin{longtable}{BTT}
\toprule \multicolumn{1}{l}{parameter} & \multicolumn{1}{l}{values} & \multicolumn{1}{l}{default}\\\midrule\endhead
\bottomrule\endfoot
\input alphabetical-option-list
\end{longtable}
\newpage
\section{Todo}

The next thing I will add are components with multiple internal
reflections, as right-angle, penta and dove prisms. The code is almost
ready, I just need to think a bit more about the best way to provide
access to the nodes that are newly defined within the components.

Drawing of extended beams with focusing and so on could be integrated to
some extent in future versions. But as the topic is rather difficult if
you want to do it properly (components should be placed above the beam,
but the new nodes are available only when the component is drawn) it
could take very long until this feature will be implemented.

\section{Acknowledgements}

I thank all the people of the PSTricks mailinglist for the continuous help, especially Herbert Voﬂ.

\section{History}

For the package history see file Changes that is distributed with the package.
\end{document}
